
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pyspatialml.rasterlayer &#8212; Pyspatialml 0.0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head><body>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Pyspatialml 0.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pyspatialml.rasterlayer</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pyspatialml.rasterlayer</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">from</span> <span class="nn">rasterio.features</span> <span class="kn">import</span> <span class="n">sieve</span>
<span class="kn">from</span> <span class="nn">rasterio.fill</span> <span class="kn">import</span> <span class="n">fillnodata</span>
<span class="kn">from</span> <span class="nn">rasterio.windows</span> <span class="kn">import</span> <span class="n">Window</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">ndimage</span>

<span class="kn">import</span> <span class="nn">pyspatialml.base</span>

<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">_get_nodata</span>
<span class="kn">from</span> <span class="nn">.plotting</span> <span class="kn">import</span> <span class="n">discrete_cmap</span>
<span class="kn">from</span> <span class="nn">.temporary_files</span> <span class="kn">import</span> <span class="n">_file_path_tempfile</span>


<div class="viewcode-block" id="RasterLayer"><a class="viewcode-back" href="../../pyspatialml.html#pyspatialml.rasterlayer.RasterLayer">[docs]</a><span class="k">class</span> <span class="nc">RasterLayer</span><span class="p">(</span><span class="n">pyspatialml</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">BaseRaster</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents a single raster band derived from a single or multi-band raster</span>
<span class="sd">    dataset</span>

<span class="sd">    Simple wrapper around a rasterio.Band object with additional methods. Used because</span>
<span class="sd">    the Rasterio.Band.ds.read method reads all bands from a multi-band dataset, whereas</span>
<span class="sd">    the RasterLayer read method only reads a single band.</span>

<span class="sd">    Methods encapsulated in RasterLayer objects represent those that typically would</span>
<span class="sd">    only be applied to a single-band of a raster, i.e. sieve-clump, distance to non-NaN</span>
<span class="sd">    pixels, or arithmetic operations on individual layers.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    bidx : int</span>
<span class="sd">        The band index of the RasterLayer within the file dataset.</span>
<span class="sd">    </span>
<span class="sd">    dtype : str</span>
<span class="sd">        The data type of the RasterLayer.</span>
<span class="sd">    </span>
<span class="sd">    nodata : any number</span>
<span class="sd">        The number that is used to represent nodata pixels in the RasterLayer.</span>
<span class="sd">    </span>
<span class="sd">    file : str</span>
<span class="sd">        The file path to the dataset.</span>
<span class="sd">    </span>
<span class="sd">    ds : rasterio.band</span>
<span class="sd">        The underlying rasterio.band object.</span>

<span class="sd">    driver : str</span>
<span class="sd">        The name of the GDAL format driver.</span>
<span class="sd">    </span>
<span class="sd">    meta : dict</span>
<span class="sd">        A python dict storing the RasterLayer metadata.</span>
<span class="sd">    </span>
<span class="sd">    cmap : str</span>
<span class="sd">        The name of matplotlib map, or a custom matplotlib.cm.LinearSegmentedColormap </span>
<span class="sd">        or ListedColormap object.</span>

<span class="sd">    norm : matplotlib.colors.Normalize (opt)</span>
<span class="sd">        A matplotlib.colors.Normalize to apply to the RasterLayer.</span>
<span class="sd">        This overides the norm attribute of the RasterLayer.</span>
<span class="sd">    </span>
<span class="sd">     : int</span>
<span class="sd">        Number of layers; always equal to 1.</span>
<span class="sd">    </span>
<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    close :</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">band</span><span class="p">):</span>

        <span class="c1"># access inherited methods/attributes overridden by __init__</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">band</span><span class="p">)</span>

        <span class="c1"># rasterlayer specific attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bidx</span> <span class="o">=</span> <span class="n">band</span><span class="o">.</span><span class="n">bidx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">band</span><span class="o">.</span><span class="n">dtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodata</span> <span class="o">=</span> <span class="n">band</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">nodata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">band</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="o">=</span> <span class="n">band</span><span class="o">.</span><span class="n">ds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">band</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;driver&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">band</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">meta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;viridis&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">categorical</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_make_name</span><span class="p">(</span><span class="n">band</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_close</span> <span class="o">=</span> <span class="n">band</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">close</span>
    
<div class="viewcode-block" id="RasterLayer.close"><a class="viewcode-back" href="../../pyspatialml.html#pyspatialml.rasterlayer.RasterLayer.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Close the RasterLayer for reading/writing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_close</span></div>

    <span class="k">def</span> <span class="nf">_arith</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;General method for performing arithmetic operations on RasterLayer objects</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        function : function</span>
<span class="sd">            Custom function that takes either one or two arrays, and returns a single</span>
<span class="sd">            array following a pre-defined calculation.</span>

<span class="sd">        other : pyspatialml.RasterLayer (optional, default None)</span>
<span class="sd">            If not specified, then a `function` should be provided that performs a</span>
<span class="sd">            calculation using only the selected RasterLayer. If `other` is specified,</span>
<span class="sd">            then a `function` should be supplied that takes to ndarrays as arguments</span>
<span class="sd">            and performs a calculation using both layers, i.e. layer1 - layer2.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pyspatialml.RasterLayer</span>
<span class="sd">            Returns a single RasterLayer containing the calculated result.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">tfile</span> <span class="o">=</span> <span class="n">_file_path_tempfile</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">driver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span>

        <span class="c1"># determine dtype of result based on calc on single pixel</span>
        <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">arr1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">masked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">Window</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">arr2</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">masked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">Window</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">arr2</span> <span class="o">=</span> <span class="n">other</span>

            <span class="n">test</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="p">)</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">dtype</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span>

        <span class="n">nodata</span> <span class="o">=</span> <span class="n">_get_nodata</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>

        <span class="c1"># open output file with updated metadata</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span>
        <span class="n">meta</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">driver</span><span class="o">=</span><span class="n">driver</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">nodata</span><span class="o">=</span><span class="n">nodata</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tfile</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">meta</span><span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>

            <span class="c1"># define windows</span>
            <span class="n">windows</span> <span class="o">=</span> <span class="p">[</span><span class="n">window</span> <span class="k">for</span> <span class="n">ij</span><span class="p">,</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">dst</span><span class="o">.</span><span class="n">block_windows</span><span class="p">()]</span>

            <span class="c1"># generator gets raster arrays for each window</span>
            <span class="n">self_gen</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">masked</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">RasterLayer</span><span class="p">):</span>
                <span class="n">other_gen</span> <span class="o">=</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">masked</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">other_gen</span> <span class="o">=</span> <span class="p">(</span><span class="n">other</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">window</span><span class="p">,</span> <span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">windows</span><span class="p">,</span> <span class="n">self_gen</span><span class="p">,</span> <span class="n">other_gen</span><span class="p">):</span>

                <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">arr1</span><span class="p">)</span>

                <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">nodata</span><span class="p">)</span>
                <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">),</span> <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span> <span class="n">indexes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># create RasterLayer from result</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tfile</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">band</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">band</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">layer</span> <span class="o">=</span> <span class="n">pyspatialml</span><span class="o">.</span><span class="n">RasterLayer</span><span class="p">(</span><span class="n">band</span><span class="p">)</span>

        <span class="c1"># overwrite close attribute with close method from temporaryfilewrapper</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">close</span> <span class="o">=</span> <span class="n">tfile</span><span class="o">.</span><span class="n">close</span>

        <span class="k">return</span> <span class="n">layer</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Implements behaviour for addition of two RasterLayers,</span>
<span class="sd">        i.e. added_layer = layer1 + layer2</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">arr1</span> <span class="o">+</span> <span class="n">arr2</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arith</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Implements behaviour for subtraction of two RasterLayers, i.e.</span>
<span class="sd">        subtracted_layer = layer1 - layer2</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">arr1</span> <span class="o">-</span> <span class="n">arr2</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arith</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Implements behaviour for multiplication of two RasterLayers, i.e.</span>
<span class="sd">        product = layer1 * layer2</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">arr1</span> <span class="o">*</span> <span class="n">arr2</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arith</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Implements behaviour for division using `/` of two RasterLayers, i.e.</span>
<span class="sd">        div = layer1 / layer2</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">arr1</span> <span class="o">/</span> <span class="n">arr2</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arith</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Implements &amp; operator</span>

<span class="sd">        Equivalent to a intersection operation of self</span>
<span class="sd">        with other, i.e. intersected = layer1 &amp; layer2.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="p">):</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="p">)</span><span class="o">.</span><span class="n">mask</span>
            <span class="n">arr1</span><span class="o">.</span><span class="n">mask</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="n">arr1</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arith</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Implements | operator</span>

<span class="sd">        Fills gaps in self with pixels from other. Equivalent to a union operation,</span>
<span class="sd">        i.e. union = layer1 | layer2.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="p">):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span><span class="o">.</span><span class="n">mask</span>
            <span class="n">arr1</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr2</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">arr1</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arith</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__xor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Exclusive OR using ^</span>

<span class="sd">        Equivalent to a symmetrical difference where the result comprises pixels that</span>
<span class="sd">        occur in self or other, but not both, i.e. xor = layer1 ^ layer2.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="p">):</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">logical_xor</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span><span class="o">.</span><span class="n">mask</span>
            <span class="n">arr1</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr2</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">arr1</span><span class="o">.</span><span class="n">mask</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">mask</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="n">arr1</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arith</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__round__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ndigits</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Behaviour for round() function, i.e. round(layer)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">ndigits</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">ndigits</span><span class="p">)</span>

        <span class="n">func</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="n">ndigits</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arith</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__floor__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Rounding down to the nearest integer using math.floor(), i.e. math.floor(layer)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arith</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__ceil__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Rounding up to the nearest integer using math.ceil(), i.e. math.ceil(layer)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arith</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__trunc__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Truncating to an integral using math.trunc(), i.e. math.trunc(layer)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">trunc</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arith</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;abs() function as applied to a RasterLayer, i.e. abs(layer)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arith</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Unary positive, i.e. +layer1</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">positive</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arith</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unary negative, i.e. -layer1</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">negative</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arith</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

<div class="viewcode-block" id="RasterLayer.read"><a class="viewcode-back" href="../../pyspatialml.html#pyspatialml.rasterlayer.RasterLayer.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read method for a single RasterLayer.</span>

<span class="sd">        Reads the pixel values from a RasterLayer into a ndarray that always</span>
<span class="sd">        will have two dimensions in the order of (rows, columns).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **kwargs : named arguments that can be passed to the the</span>
<span class="sd">        rasterio.DatasetReader.read method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;resampling&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">resampling_methods</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">enums</span><span class="o">.</span><span class="n">Resampling</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;resampling&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">resampling_methods</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Invalid resampling method.&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;Resampling method must be one of </span><span class="si">{0}</span><span class="s2">:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resampling_methods</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;resampling&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">enums</span><span class="o">.</span><span class="n">Resampling</span><span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;resampling&quot;</span><span class="p">]]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">indexes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bidx</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s2">&quot;GTiff&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nodata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal function to write processed results to a file, usually a tempfile</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># generate a file path to a temporary file is file_path is None</span>
        <span class="n">file_path</span><span class="p">,</span> <span class="n">tfile</span> <span class="o">=</span> <span class="n">_file_path_tempfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span>

        <span class="k">if</span> <span class="n">nodata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nodata</span> <span class="o">=</span> <span class="n">_get_nodata</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>

        <span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">meta</span>
        <span class="n">meta</span><span class="p">[</span><span class="s2">&quot;driver&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">driver</span>
        <span class="n">meta</span><span class="p">[</span><span class="s2">&quot;nodata&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodata</span>
        <span class="n">meta</span><span class="p">[</span><span class="s2">&quot;dtype&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dtype</span>

        <span class="c1"># mask any nodata values</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_equal</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodata</span><span class="p">)</span>
        
        <span class="c1"># replace masked values with the user-specified nodata value</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">nodata</span><span class="p">)</span>

        <span class="c1"># write to file</span>
        <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">meta</span><span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>
            <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">src</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">band</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">band</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">layer</span> <span class="o">=</span> <span class="n">pyspatialml</span><span class="o">.</span><span class="n">RasterLayer</span><span class="p">(</span><span class="n">band</span><span class="p">)</span>

        <span class="c1"># override RasterLayer close method if temp file is used</span>
        <span class="k">if</span> <span class="n">tfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">layer</span><span class="o">.</span><span class="n">close</span> <span class="o">=</span> <span class="n">tfile</span><span class="o">.</span><span class="n">close</span>

        <span class="k">return</span> <span class="n">layer</span>

<div class="viewcode-block" id="RasterLayer.write"><a class="viewcode-back" href="../../pyspatialml.html#pyspatialml.rasterlayer.RasterLayer.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s2">&quot;GTiff&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nodata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write method for a single RasterLayer.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file_path : str (opt)</span>
<span class="sd">            File path to save the dataset.</span>
<span class="sd">        </span>
<span class="sd">        driver : str</span>
<span class="sd">            GDAL-compatible driver used for the file format.</span>
<span class="sd">        </span>
<span class="sd">        dtype : str (opt)</span>
<span class="sd">            Numpy dtype used for the file. If omitted then the RasterLayer&#39;s dtype is</span>
<span class="sd">            used.</span>
<span class="sd">        </span>
<span class="sd">        nodata : any number (opt)</span>
<span class="sd">            A value used to represent the nodata pixels. If omitted then the RasterLayer&#39;s </span>
<span class="sd">            nodata value is used (if assigned already).</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pyspatialml.RasterLayer</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">driver</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">nodata</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">layer</span></div>

<div class="viewcode-block" id="RasterLayer.fill"><a class="viewcode-back" href="../../pyspatialml.html#pyspatialml.rasterlayer.RasterLayer.fill">[docs]</a>    <span class="k">def</span> <span class="nf">fill</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">max_search_distance</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">smoothing_iterations</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">driver</span><span class="o">=</span><span class="s2">&quot;GTiff&quot;</span><span class="p">,</span>
        <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">nodata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fill nodata gaps in a RasterLayer</span>

<span class="sd">        Thin wrapper around the rasterio.fill.fillnodata method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mask : numpy.ndarray (optional, default None)</span>
<span class="sd">            Optionally provide a numpy array to indice which pixels to fill. Pixels</span>
<span class="sd">            designated to fill should have zero values in the mask, and values &gt; 0 in</span>
<span class="sd">            the mask indicate pixels to use for interpolation.</span>
<span class="sd">        </span>
<span class="sd">        max_search_distance : float (default 100)</span>
<span class="sd">            The maximum number of pixels in all directions to use for interpolation.</span>
<span class="sd">        </span>
<span class="sd">        smoothing_iterations : integer (default 0)</span>
<span class="sd">            The number of 3x3 smoothing filter passes to run. The default is 0.</span>
<span class="sd">        </span>
<span class="sd">        file_path : str (optional, default None)</span>
<span class="sd">            Optional path to save calculated Raster object. If not specified then a</span>
<span class="sd">            tempfile is used.</span>

<span class="sd">        driver : str (default &#39;GTiff&#39;)</span>
<span class="sd">            Named of GDAL-supported driver for file export.</span>

<span class="sd">        nodata : any number (optional, default None)</span>
<span class="sd">            Nodata value for new dataset. If not specified then a nodata value is set</span>
<span class="sd">            based on the minimum permissible value of the Raster&#39;s data type.</span>

<span class="sd">        dtype : str (optional, default None)</span>
<span class="sd">            Optionally specify a numpy compatible data type when saving to file. If not</span>
<span class="sd">            specified, a data type is set based on the data type of the RasterLayer.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pyspatialml.RasterLayer</span>
<span class="sd">            Filled RasterLayer</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">arr</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">fill</span><span class="o">.</span><span class="n">fillnodata</span><span class="p">(</span>
            <span class="n">image</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">masked</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
            <span class="n">max_search_distance</span><span class="o">=</span><span class="n">max_search_distance</span><span class="p">,</span>
            <span class="n">smoothing_iterations</span><span class="o">=</span><span class="n">smoothing_iterations</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">driver</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">nodata</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">layer</span></div>

<div class="viewcode-block" id="RasterLayer.sieve"><a class="viewcode-back" href="../../pyspatialml.html#pyspatialml.rasterlayer.RasterLayer.sieve">[docs]</a>    <span class="k">def</span> <span class="nf">sieve</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">connectivity</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">driver</span><span class="o">=</span><span class="s2">&quot;GTiff&quot;</span><span class="p">,</span>
        <span class="n">nodata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Replace pixels with their largest neighbor</span>

<span class="sd">        Thin wrapper around the rasterio.features.sieve method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : integer (default 2)</span>
<span class="sd">            Minimum number of contigous pixels to retain</span>
<span class="sd">        </span>
<span class="sd">        mask : ndarray (optional, default None)</span>
<span class="sd">            Values of False or 0 will be excluded from the sieving process</span>
<span class="sd">        </span>
<span class="sd">        connectivity : integer (default 4)</span>
<span class="sd">            Use 4 or 8 pixel connectivity for grouping pixels into features.</span>
<span class="sd">            Default is 4.</span>

<span class="sd">        file_path : str (optional, default None)</span>
<span class="sd">            Optional path to save calculated Raster object. If not</span>
<span class="sd">            specified then a tempfile is used.</span>

<span class="sd">        driver : str (default &#39;GTiff&#39;)</span>
<span class="sd">            Named of GDAL-supported driver for file export.</span>

<span class="sd">        nodata : any number (optional, default None)</span>
<span class="sd">            Nodata value for new dataset. If not specified then a nodata value is set</span>
<span class="sd">            based on the minimum permissible value of the Raster&#39;s data type.</span>

<span class="sd">        dtype : str (optional, default None)</span>
<span class="sd">            Optionally specify a numpy compatible data type when saving to file. If not</span>
<span class="sd">            specified, a data type is set based on the data type of the RasterLayer.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pyspatialml.RasterLayer</span>
<span class="sd">            Filled RasterLayer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">sieve</span><span class="p">(</span>
            <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">masked</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
            <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
            <span class="n">connectivity</span><span class="o">=</span><span class="n">connectivity</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">driver</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">nodata</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">layer</span></div>

<div class="viewcode-block" id="RasterLayer.distance"><a class="viewcode-back" href="../../pyspatialml.html#pyspatialml.rasterlayer.RasterLayer.distance">[docs]</a>    <span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s2">&quot;GTiff&quot;</span><span class="p">,</span> <span class="n">nodata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate euclidean grid distances to non-NaN pixels</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file_path : str (optional, default None)</span>
<span class="sd">            Optional path to save calculated Raster object. If not specified then a</span>
<span class="sd">            tempfile is used.</span>

<span class="sd">        driver : str (default &#39;GTiff&#39;)</span>
<span class="sd">            Named of GDAL-supported driver for file export.</span>

<span class="sd">        nodata : any number (optional, default None)</span>
<span class="sd">            Nodata value for new dataset. If not specified then a nodata value is set</span>
<span class="sd">            based on the minimum permissible value of the Raster&#39;s data type.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pyspatialml.RasterLayer</span>
<span class="sd">            Grid distance raster</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">masked</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">distance_transform_edt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">arr</span><span class="p">)</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span>

        <span class="n">layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">driver</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">nodata</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">layer</span></div>

<div class="viewcode-block" id="RasterLayer.plot"><a class="viewcode-back" href="../../pyspatialml.html#pyspatialml.rasterlayer.RasterLayer.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">cax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">figsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">categorical</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">fig_kwds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">legend_kwds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot a RasterLayer using matplotlib.pyplot.imshow</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cmap : str (default None)</span>
<span class="sd">            The name of a colormap recognized by matplotlib.</span>
<span class="sd">            Overrides the cmap attribute of the RasterLayer.</span>
<span class="sd">        </span>
<span class="sd">        norm : matplotlib.colors.Normalize (opt)</span>
<span class="sd">            A matplotlib.colors.Normalize to apply to the RasterLayer.</span>
<span class="sd">            This overides the norm attribute of the RasterLayer.</span>
<span class="sd">        </span>
<span class="sd">        ax : matplotlib.pyplot.Artist (optional, default None)</span>
<span class="sd">            axes instance on which to draw to plot.</span>
<span class="sd">        </span>
<span class="sd">        cax : matplotlib.pyplot.Artist (optional, default None)</span>
<span class="sd">            axes on which to draw the legend.</span>
<span class="sd">        </span>
<span class="sd">        figsize : tuple of integers (optional, default None)</span>
<span class="sd">            Size of the matplotlib.figure.Figure. If the ax argument is given</span>
<span class="sd">            explicitly, figsize is ignored.</span>
<span class="sd">                </span>
<span class="sd">        categorical : bool (optional, default False)</span>
<span class="sd">            if True then the raster values will be considered to represent discrete</span>
<span class="sd">            values, otherwise they are considered to represent continuous values. This</span>
<span class="sd">            overrides the  RasterLayer &#39;categorical&#39; attribute. Setting the argument</span>
<span class="sd">            categorical to True is ignored if the RasterLayer.categorical is already</span>
<span class="sd">            True.</span>
<span class="sd">        </span>
<span class="sd">        legend : bool (optional, default False)</span>
<span class="sd">            Whether to plot the legend.</span>

<span class="sd">        vmin, xmax : scale (optional, default None)</span>
<span class="sd">            vmin and vmax define the data range that the colormap covers. By default,</span>
<span class="sd">            the colormap covers the complete value range of the supplied data. vmin,</span>
<span class="sd">            vmax are ignored if the norm parameter is used.</span>
<span class="sd">        </span>
<span class="sd">        fig_kwds : dict (optional, default None)</span>
<span class="sd">            Additional arguments to pass to the matplotlib.pyplot.figure call when</span>
<span class="sd">            creating the figure object. Ignored if ax is passed to the plot function.</span>

<span class="sd">        legend_kwds : dict (optional, default None)</span>
<span class="sd">            Keyword arguments to pass to matplotlib.pyplot.colorbar().</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax : matplotlib axes instance</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># some checks</span>
        <span class="k">if</span> <span class="n">fig_kwds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig_kwds</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;ax&#39; can not be None if &#39;cax&#39; is not.&quot;</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="o">**</span><span class="n">fig_kwds</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">norm</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">norm</span><span class="p">,</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                    <span class="s2">&quot;norm argument should be a matplotlib.colors.Normalize object&quot;</span>
                <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span>
        
        <span class="k">if</span> <span class="n">norm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span>

        <span class="k">if</span> <span class="n">legend_kwds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">legend_kwds</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">masked</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">categorical</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">categorical</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
                <span class="n">cmap</span> <span class="o">=</span> <span class="n">discrete_cmap</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">base_cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
            <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
            <span class="n">X</span><span class="o">=</span><span class="n">arr</span><span class="p">,</span>
            <span class="n">extent</span><span class="o">=</span><span class="n">rasterio</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">plotting_extent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">),</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
            <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
            <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
            <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">legend</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">legend_kwds</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ax</span></div>

    <span class="k">def</span> <span class="nf">_extract_by_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Spatial query of Raster object (by-band)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span><span class="p">)</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">masked</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">X</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Pyspatialml 0.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pyspatialml.rasterlayer</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Steven Pawley.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.1.1.
    </div>
  </body>
</html>